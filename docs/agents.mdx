---
title: Agents
description: Define custom agents (modes + subagents) with Markdown files
---

## Overview

mux uses **agents** to control the model's:

- **System prompt** (what the assistant "is")
- **Tool access policy** (which tools it can call)

This unifies two older concepts:

- **UI modes** (Plan/Exec/Compact)
- **Subagents** (the presets used by the `task` tool)

An **Agent Definition** is a Markdown file:

- The **YAML frontmatter** defines metadata + policy.
- The **Markdown body** becomes the agent's system prompt (layered with mux's base prelude).

## Quick Start

**Switch agents:** Press `Cmd+Shift+M` (Mac) or `Ctrl+Shift+M` (Windows/Linux), or use the agent selector in the chat input.

**Create a custom agent:** Add a markdown file with YAML frontmatter to `.mux/agents/` in your project:

```md
---
name: Review
description: Terse reviewer-style feedback
policy:
  base: exec
  tools:
    deny: ["file_edit_insert", "file_edit_replace_string"]
---

You are a code reviewer.

- Focus on correctness, risks, and test coverage.
- Prefer short, actionable comments.
```

## Discovery + Precedence

mux discovers agent definitions from (non-recursive):

| Location             | Scope   | Priority |
| -------------------- | ------- | -------- |
| `.mux/agents/*.md`   | Project | Highest  |
| `~/.mux/agents/*.md` | Global  | Medium   |
| Built-in             | System  | Lowest   |

Higher-priority definitions override lower-priority ones with the same **agent id**.

### Agent IDs

The **agent id** is derived from the filename:

- `review.md` → `agentId = "review"`

Agent ids are lowercase and should be simple (letters/numbers with `-`/`_`).

## File Format

### Frontmatter Schema

```yaml
---
# Required
name: My Agent # Display name in UI

# Optional
description: What this agent does # Shown in tooltips
color: "#6b5bff" # UI accent color

# UI visibility
ui:
  hidden: false # Set true to hide from agent selector
  disabled: false # Set true to completely disable (useful to hide built-ins)

# Subagent configuration
subagent:
  runnable: false # Allow spawning via task({ agentId: ... })

# AI defaults (override user settings)
ai:
  modelString: anthropic:claude-sonnet-4-5
  thinkingLevel: medium

# Tool policy
policy:
  base: exec # Base policy: plan | exec | compact
  tools:
    deny: ["tool_a", "tool_b"] # OR
    only: ["tool_x", "tool_y"] # (mutually exclusive)

# Alternative tool control (simpler syntax)
permissionMode: default # "default" or "readOnly"
tools: ["task", "task_.*"] # Tools to enable (regex patterns)
disallowedTools: ["bash"] # Tools to disable
---
```

### Markdown Body (Instructions)

The markdown body after the frontmatter becomes the agent's system prompt, layered with mux's base prelude.

## Disabling Built-in Agents

To hide a built-in agent, create a file with the same name and `ui.disabled: true`:

```md
---
name: Plan
ui:
  disabled: true
---
```

This completely removes the agent from discovery. To override (replace) a built-in instead, omit `disabled` and provide your own configuration.

## Tool Policy Semantics

- `policy.base: plan` — Plan-mode behaviors (e.g., `ask_user_question`, `propose_plan`)
- `policy.base: exec` — Normal coding workflow with full tool access
- `policy.base: compact` — Internal no-tools flow for history compaction

**Hard denies in subagents:** Even if an agent definition allows them, mux blocks these tools in child workspaces:

- `task`, `task_await`, `task_list`, `task_terminate` (no recursive spawning)
- `propose_plan`, `ask_user_question` (UI-only tools)

## Using Agents

### Main Agent

Use the agent selector in the chat input to switch agents.

Keyboard: `Cmd+Shift+M` (mac) / `Ctrl+Shift+M` (win/linux) cycles between agents.

### Subagents (task tool)

Spawn a subagent workspace with:

```ts
task({
  agentId: "explore",
  title: "Find the callsites",
  prompt: "Locate where X is computed and report back",
});
```

Only agents with `subagent.runnable: true` can be used this way.

## Examples

### Security Audit Agent

```md
---
name: Security Audit
description: Security-focused code review
policy:
  base: exec
  tools:
    deny: ["file_edit_insert", "file_edit_replace_string", "bash"]
---

You are a security auditor. Analyze the codebase for:

- Authentication/authorization issues
- Injection vulnerabilities
- Data exposure risks
- Insecure dependencies

Provide a structured report with severity levels. Do not make changes.
```

### Documentation Agent

```md
---
name: Docs
description: Focus on documentation tasks
---

You are in Documentation mode. Focus on improving documentation:
README files, code comments, API docs, and guides. Avoid
refactoring code unless it's purely for documentation purposes.
```

## Built-in Agents

{/* BEGIN BUILTIN_AGENTS */}

### Exec

**Implement changes in the repository**

<Accordion title="View exec.md">

```md
---
name: Exec
description: Implement changes in the repository
subagent:
  runnable: true
policy:
  base: exec
permissionMode: default
---

You are in Exec mode.

- Make minimal, correct, reviewable changes that match existing codebase patterns.
- Prefer targeted commands and checks (typecheck/tests) when feasible.

If you are running as a sub-agent in a child workspace:

- When you have a final answer, call agent_report exactly once.
- Do not call task/task_await/task_list/task_terminate (subagent recursion is disabled).
- Do not call propose_plan.
```

</Accordion>

### Plan

**Create a plan before coding**

<Accordion title="View plan.md">

```md
---
name: Plan
description: Create a plan before coding
subagent:
  runnable: false
policy:
  base: plan
permissionMode: default
---

You are in Plan Mode.

- Produce a crisp, actionable plan before making code changes.
- Keep the plan scannable; put long rationale in <details>/<summary> blocks.

Note: mux will provide a concrete plan file path separately.
```

</Accordion>

### Compact (internal)

**History compaction (internal)**

<Accordion title="View compact.md">

```md
---
name: Compact
description: History compaction (internal)
ui:
  hidden: true
subagent:
  runnable: false
policy:
  base: compact
---

You are running a compaction/summarization pass. Do not call tools.
```

</Accordion>

### Explore (internal)

**Read-only repository exploration**

<Accordion title="View explore.md">

```md
---
name: Explore
description: Read-only repository exploration
ui:
  hidden: true
subagent:
  runnable: true
policy:
  base: exec
  tools:
    only:
      - file_read
      - bash
      - bash_output
      - bash_background_list
      - bash_background_terminate
      - web_fetch
      - web_search
      - google_search
      - agent_report
---

You are an Explore sub-agent running inside a child workspace.

Goals:

- Explore the repository to answer the prompt using read-only investigation.
- Return concise, actionable findings (paths, symbols, callsites, and facts).

Rules:
=== CRITICAL: READ-ONLY MODE - NO FILE MODIFICATIONS ===

- You MUST NOT create, edit, delete, move, or copy files.
- You MUST NOT create temporary files anywhere (including /tmp).
- You MUST NOT use redirect operators (>, >>, |) or heredocs to write to files.
- You MUST NOT run commands that change system state (rm, mv, cp, mkdir, touch, git add/commit, installs, etc.).
- Use bash only for read-only operations (rg, ls, cat, git diff/show/log, etc.).
- Do not call task/task_await/task_list/task_terminate (subagent recursion is disabled).

Reporting:

- When you have a final answer, call agent_report exactly once.
- Do not call agent_report until you have completed the assigned task and integrated all relevant findings.
```

</Accordion>

{/* END BUILTIN_AGENTS */}

## Related Docs

- Scoped instructions in `AGENTS.md`: see [Instruction Files](/instruction-files)
- Built-in skills (`agent_skill_read`): see [Agent Skills](/agent-skills)
